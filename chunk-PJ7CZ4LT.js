import{b as m,ea as f}from"./chunk-3GOEH257.js";import{a as l,b as g,j as U}from"./chunk-YP77TDRT.js";import{$ as p,L as h,ea as i,g as o,n as c,u}from"./chunk-YS66BBCY.js";var T=(()=>{let r=class r{constructor(e,t,s,a){this.http=e,this.baseUrl=t,this.router=s,this.snackBar=a,this.isLoadingUser=!1,this.currentUserSubject=new c(null),this.loadUser()}get isLoading(){return this.isLoadingUser}get currentUser(){return this.currentUserSubject.value}isAuthenticated(){return!!this.getUserToken()}getUserToken(){return localStorage.getItem("user-token")}getUser(){return this.http.get(`${this.baseUrl}/user`)}loadUser(){return o(this,null,function*(){if(!this.getUserToken())return;this.isLoadingUser=!0,(yield this.getUser()).pipe(h(()=>{this.isLoadingUser=!1})).subscribe({next:t=>{this.currentUserSubject.next(t)},error:({status:t,statusText:s})=>{this.snackBar.open(`HTTP Error, ${t} ${s}.`,"Dismiss"),t===l.Unauthorized&&(localStorage.removeItem("user-token"),this.router.navigate(["/"]))}})})}login(e,t){return this.http.post(`${this.baseUrl}/auth/login`,{email:e,password:t}).pipe(u(s=>o(this,null,function*(){return this.setupUser(s.accessToken),!0})))}signup(e,t,s){return this.http.post(`${this.baseUrl}/auth/signup`,{name:s,email:e,password:t}).pipe(u(a=>o(this,null,function*(){return this.setupUser(a.accessToken),!0})))}setupUser(e){localStorage.setItem("user-token",e),this.loadUser(),this.router.navigate(["/"])}logout(){localStorage.removeItem("user-token"),this.currentUserSubject.next(null),this.router.navigate(["/"])}};r.\u0275fac=function(t){return new(t||r)(i(g),i(m),i(U),i(f))},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();export{T as a};
