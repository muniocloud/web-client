import{a as ze,b as $e,c as Ue,d as Xe}from"./chunk-JFQROGYZ.js";import{a as Ne,b as He}from"./chunk-Q5R273OE.js";import{c as Be,d as Ye}from"./chunk-YJD6ZQFG.js";import{K as J,O as P,P as Ae,V as Fe,Y as Ve,aa as F,b as q,d as ke,da as je,ea as K,f as De,h as Pe,i as oe,j as ne,o as Me,t as Ee,u as Re,v as Oe,w as re}from"./chunk-3GOEH257.js";import"./chunk-IX6G3U3V.js";import{b as Z,h as Le,j as W}from"./chunk-YP77TDRT.js";import{d as Se,h as G,j as D,l as Q,m as I}from"./chunk-IQVPVRV2.js";import{$b as U,Ab as Ce,Bb as l,Cb as c,Db as w,Eb as Ie,Fb as xe,Ha as fe,Hb as g,Kb as f,L as E,Mb as p,Nb as H,Ob as B,Qb as Y,Rb as z,Sb as $,Ta as _e,Ub as v,V as T,Vb as O,Wb as A,Xa as m,Ya as a,Zb as y,_b as Te,a as L,aa as de,ac as X,b as ce,ca as te,eb as ue,fa as ie,gb as ge,ha as b,hb as ve,ia as pe,ja as he,kc as we,m as ee,n as M,pb as x,qa as _,ra as u,rb as d,sb as be,tb as se,wa as me,xb as N,ya as k,za as R,zb as ye}from"./chunk-YS66BBCY.js";var Ge=(()=>{let s=class s{constructor(e,t){this.router=e,this.markdownService=t,this.sessionFeedbackHTML=""}goHome(){this.router.navigate(["/"])}ngOnInit(){this.sessionFeedbackHTML=this.markdownService.convertTextToHTML(this.feedback)}};s.\u0275fac=function(t){return new(t||s)(a(W),a($e))},s.\u0275cmp=b({type:s,selectors:[["app-session-feedback"]],inputs:{feedback:"feedback",rating:"rating"},standalone:!0,features:[y],decls:7,vars:2,consts:[[1,"mat-title-small"],[3,"innerHTML"],["mat-flat-button","",1,"full-btn",3,"click"]],template:function(t,i){t&1&&(l(0,"main")(1,"h2",0),v(2),c(),w(3,"p",1),c(),l(4,"footer")(5,"button",2),f("click",function(){return i.goHome()}),v(6,"Home"),c()()),t&2&&(m(2),A("Rating ",i.rating," of 10."),m(),d("innerHTML",i.sessionFeedbackHTML,_e))},dependencies:[P,J],styles:[".full-btn[_ngcontent-%COMP%]{width:100%}"]});let o=s;return o})();var ct=["tooltip"],We=20;var qe=new te("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let o=ie(F);return()=>o.scrollStrategies.reposition({scrollThrottle:We})}});function dt(o){return()=>o.scrollStrategies.reposition({scrollThrottle:We})}var pt={provide:qe,deps:[F],useFactory:dt};function ht(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}var mt=new te("mat-tooltip-default-options",{providedIn:"root",factory:ht});var Qe="tooltip-panel",Ze=De({passive:!0}),ft=8,_t=8,ut=24,gt=200,Je=(()=>{let s=class s{get position(){return this._position}set position(e){e!==this._position&&(this._position=e,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(e){this._positionAtOrigin=oe(e),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(e){this._disabled=oe(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=ne(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=ne(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e!=null?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(e,t,i,r,h,S,j,st,ot,le,C,nt){this._overlay=e,this._elementRef=t,this._scrollDispatcher=i,this._viewContainerRef=r,this._ngZone=h,this._platform=S,this._ariaDescriber=j,this._focusMonitor=st,this._dir=le,this._defaultOptions=C,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=vt,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new ee,this._injector=ie(me),this._scrollStrategy=ot,this._document=nt,C&&(this._showDelay=C.showDelay,this._hideDelay=C.hideDelay,C.position&&(this.position=C.position),C.positionAtOrigin&&(this.positionAtOrigin=C.positionAtOrigin),C.touchGestures&&(this.touchGestures=C.touchGestures)),le.change.pipe(T(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=ft}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(T(this._destroyed)).subscribe(e=>{e?e==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([t,i])=>{e.removeEventListener(t,i,Ze)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(e,this.message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay,t){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let i=this._createOverlay(t);this._detach(),this._portal=this._portal||new Ae(this._tooltipComponent,this._viewContainerRef);let r=this._tooltipInstance=i.attach(this._portal).instance;r._triggerElement=this._elementRef.nativeElement,r._mouseLeaveHideDelay=this._hideDelay,r.afterHidden().pipe(T(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),r.show(e)}hide(e=this.hideDelay){let t=this._tooltipInstance;t&&(t.isVisible()?t.hide(e):(t._cancelPendingAnimations(),this._detach()))}toggle(e){this._isTooltipVisible()?this.hide():this.show(void 0,e)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(e){if(this._overlayRef){let r=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!e)&&r._origin instanceof R)return this._overlayRef;this._detach()}let t=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),i=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin?e||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(t);return i.positionChanges.pipe(T(this._destroyed)).subscribe(r=>{this._updateCurrentPositionClass(r.connectionPair),this._tooltipInstance&&r.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:i,panelClass:`${this._cssClassPrefix}-${Qe}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(T(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(T(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(T(this._destroyed)).subscribe(r=>{this._isTooltipVisible()&&r.keyCode===27&&!Pe(r)&&(r.preventDefault(),r.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(e){let t=e.getConfig().positionStrategy,i=this._getOrigin(),r=this._getOverlayPosition();t.withPositions([this._addOffset(L(L({},i.main),r.main)),this._addOffset(L(L({},i.fallback),r.fallback))])}_addOffset(e){let t=_t,i=!this._dir||this._dir.value=="ltr";return e.originY==="top"?e.offsetY=-t:e.originY==="bottom"?e.offsetY=t:e.originX==="start"?e.offsetX=i?-t:t:e.originX==="end"&&(e.offsetX=i?t:-t),e}_getOrigin(){let e=!this._dir||this._dir.value=="ltr",t=this.position,i;t=="above"||t=="below"?i={originX:"center",originY:t=="above"?"top":"bottom"}:t=="before"||t=="left"&&e||t=="right"&&!e?i={originX:"start",originY:"center"}:(t=="after"||t=="right"&&e||t=="left"&&!e)&&(i={originX:"end",originY:"center"});let{x:r,y:h}=this._invertPosition(i.originX,i.originY);return{main:i,fallback:{originX:r,originY:h}}}_getOverlayPosition(){let e=!this._dir||this._dir.value=="ltr",t=this.position,i;t=="above"?i={overlayX:"center",overlayY:"bottom"}:t=="below"?i={overlayX:"center",overlayY:"top"}:t=="before"||t=="left"&&e||t=="right"&&!e?i={overlayX:"end",overlayY:"center"}:(t=="after"||t=="right"&&e||t=="left"&&!e)&&(i={overlayX:"start",overlayY:"center"});let{x:r,y:h}=this._invertPosition(i.overlayX,i.overlayY);return{main:i,fallback:{overlayX:r,overlayY:h}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),ge(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_invertPosition(e,t){return this.position==="above"||this.position==="below"?t==="top"?t="bottom":t==="bottom"&&(t="top"):e==="end"?e="start":e==="start"&&(e="end"),{x:e,y:t}}_updateCurrentPositionClass(e){let{overlayY:t,originX:i,originY:r}=e,h;if(t==="center"?this._dir&&this._dir.value==="rtl"?h=i==="end"?"left":"right":h=i==="start"?"left":"right":h=t==="bottom"&&r==="top"?"above":"below",h!==this._currentPosition){let S=this._overlayRef;if(S){let j=`${this._cssClassPrefix}-${Qe}-`;S.removePanelClass(j+this._currentPosition),S.addPanelClass(j+h)}this._currentPosition=h}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",e=>{this._setupPointerExitEventsIfNeeded();let t;e.x!==void 0&&e.y!==void 0&&(t=e),this.show(void 0,t)}]):this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",e=>{let t=e.targetTouches?.[0],i=t?{x:t.clientX,y:t.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout);let r=500;this._touchstartTimeout=setTimeout(()=>this.show(void 0,i),this._defaultOptions.touchLongPressShowDelay??r)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;let e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",t=>{let i=t.relatedTarget;(!i||!this._overlayRef?.overlayElement.contains(i))&&this.hide()}],["wheel",t=>this._wheelListener(t)]);else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let t=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",t],["touchcancel",t])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([t,i])=>{this._elementRef.nativeElement.addEventListener(t,i,Ze)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){let t=this._document.elementFromPoint(e.clientX,e.clientY),i=this._elementRef.nativeElement;t!==i&&!i.contains(t)&&this.hide()}}_disableNativeGesturesIfNecessary(){let e=this.touchGestures;if(e!=="off"){let t=this._elementRef.nativeElement,i=t.style;(e==="on"||t.nodeName!=="INPUT"&&t.nodeName!=="TEXTAREA")&&(i.userSelect=i.msUserSelect=i.webkitUserSelect=i.MozUserSelect="none"),(e==="on"||!t.draggable)&&(i.webkitUserDrag="none"),i.touchAction="none",i.webkitTapHighlightColor="transparent"}}};s.\u0275fac=function(t){return new(t||s)(a(F),a(R),a(Fe),a(ve),a(ue),a(ke),a(Me),a(Ee),a(qe),a(Oe),a(mt,8),a(Se))},s.\u0275dir=he({type:s,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(t,i){t&2&&se("mat-mdc-tooltip-disabled",i.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0});let o=s;return o})(),vt=(()=>{let s=class s{constructor(e,t,i){this._changeDetectorRef=e,this._elementRef=t,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new ee,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled=i==="NoopAnimations"}show(e){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},e)}hide(e){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},e)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){(!e||!this._triggerElement.contains(e))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let e=this._elementRef.nativeElement.getBoundingClientRect();return e.height>ut&&e.width>=gt}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(e){let t=this._tooltip.nativeElement,i=this._showAnimation,r=this._hideAnimation;if(t.classList.remove(e?r:i),t.classList.add(e?i:r),this._isVisible!==e&&(this._isVisible=e,this._changeDetectorRef.markForCheck()),e&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let h=getComputedStyle(t);(h.getPropertyValue("animation-duration")==="0s"||h.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}e&&this._onShow(),this._animationsDisabled&&(t.classList.add("_mat-animation-noopable"),this._finalizeAnimation(e))}};s.\u0275fac=function(t){return new(t||s)(a(we),a(R),a(fe,8))},s.\u0275cmp=b({type:s,selectors:[["mat-tooltip-component"]],viewQuery:function(t,i){if(t&1&&Y(ct,7),t&2){let r;z(r=$())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(t,i){t&1&&f("mouseleave",function(h){return i._handleMouseLeave(h)}),t&2&&be("zoom",i.isVisible()?1:null)},standalone:!0,features:[y],decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(t,i){if(t&1){let r=g();l(0,"div",1,0),f("animationend",function(S){return _(r),u(i._handleAnimationEnd(S))}),l(2,"div",2),v(3),c()()}t&2&&(se("mdc-tooltip--multiline",i._isMultiline),d("ngClass",i.tooltipClass),m(3),O(i.message))},dependencies:[G],styles:['.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mdc-plain-tooltip-container-color);color:var(--mdc-plain-tooltip-supporting-text-color);border-radius:var(--mdc-plain-tooltip-container-shape);font-family:var(--mdc-plain-tooltip-supporting-text-font);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0});let o=s;return o})();var Ke=(()=>{let s=class s{};s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=pe({type:s}),s.\u0275inj=de({providers:[pt],imports:[Re,I,je,re,re,Ve]});let o=s;return o})();var yt=(o,s)=>s.id,Ct=(o,s)=>({current:o,answered:s});function It(o,s){if(o&1){let n=g();l(0,"button",1),f("click",function(){let t=_(n).$implicit,i=p();return u(i.emitLessonClick(t.id))}),c()}if(o&2){let n=s.$implicit,e=p();d("ngClass",Te(3,Ct,n.id===e.currentLessonId,n.answered))("disabled",e.isRecording)("matTooltip",e.getLessonTooltipIndicator(n,n.id===e.currentLessonId))}}var et=(()=>{let s=class s{constructor(){this.lessons=[],this.onClickLesson=k()}getLessonTooltipIndicator(e,t){return t?"You are here":e.answered?"Answered":"Jump to this"}emitLessonClick(e){return this.onClickLesson.emit(e),`/sessions/${this.sessionId}/lessons/${e}`}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=b({type:s,selectors:[["app-session-progress"]],inputs:{lessons:"lessons",currentLessonId:"currentLessonId",sessionId:"sessionId",isRecording:"isRecording"},outputs:{onClickLesson:"onClickLesson"},standalone:!0,features:[y],decls:2,vars:0,consts:[[1,"lesson-bar",3,"ngClass","disabled","matTooltip"],[1,"lesson-bar",3,"click","ngClass","disabled","matTooltip"]],template:function(t,i){t&1&&ye(0,It,1,6,"button",0,yt),t&2&&Ce(i.lessons)},dependencies:[I,G,Ke,Je],styles:["[_nghost-%COMP%]{flex:1;display:flex;gap:8px}[_nghost-%COMP%]   .lesson-bar[_ngcontent-%COMP%]{flex:1;min-height:8px;border-radius:10px;cursor:pointer;border:none;outline:none}"]});let o=s;return o})();var wt=["audioRecorder"],St=["*"];function Lt(o,s){if(o&1){let n=g();l(0,"header")(1,"h2",3),v(2,"Speak the phrase:"),c(),l(3,"p",4),v(4),c(),l(5,"p",5),v(6,"Click on button bellow and start speaking. Click again to stop recording."),c()(),l(7,"main")(8,"app-audio-recorder",6,0),f("onReady",function(){_(n);let t=p();return u(t.subscribeAudioRecorder())}),c()()}if(o&2){let n=p();m(4),A('"',n.lesson.phrase,'"')}}function kt(o,s){o&1&&(l(0,"div",7),w(1,"mat-progress-bar",8),c())}function Dt(o,s){if(o&1){let n=g();l(0,"header")(1,"p",4),v(2),c()(),l(3,"main"),w(4,"app-audio-visualizer",9),l(5,"p",10),v(6),c()(),l(7,"footer",11)(8,"button",12),f("click",function(){_(n);let t=p(2);return u(t.retryLesson())}),v(9,"Retry"),c(),l(10,"button",13),f("click",function(){_(n);let t=p(2);return u(t.nextLesson())}),v(11),c()()}if(o&2){let n=p().ngIf,e=p();m(2),A('"',e.lesson.phrase,'"'),m(2),d("audioUrl",e.recordedData.url),m(2),O(n.feedback),m(5),O(n.nextLessonId?"Next lesson":"Finish session")}}function Pt(o,s){o&1&&B(0,0,["*ngIf","(feedback | async) as feedback"],Dt,12,4)}var tt=(()=>{let s=class s{constructor(e,t,i){this.http=e,this.baseUrl=t,this.snackBar=i,this.onNextLesson=k(),this.feedback=new M(null),this.recordedData=null,this.recordedDataSubscription=null,this.isSubmitting=!1}retryLesson(){this.feedback.next(null)}nextLesson(){let e=this.feedback.value?.nextLessonId??null;this.feedback.next(null),this.onNextLesson.emit(e)}subscribeAudioRecorder(){this.recordedDataSubscription?.unsubscribe(),this.recordedDataSubscription=this.recorder.getRecordedData().subscribe(e=>{this.recordedData=e,this.answerLesson(e)})}answerLesson(e){this.isSubmitting=!0;let t=new FormData;t.append("audio",e.data),this.http.post(`${this.baseUrl}/sessions/${this.sessionId}/lessons/${this.lesson.id}`,t).pipe(E(()=>{this.isSubmitting=!1})).subscribe({next:i=>{this.feedback.next(i)},error:()=>{this.snackBar.open("We're with troble to send your answer. Please, try again.","Ok")}})}ngOnDestroy(){this.recordedDataSubscription?.unsubscribe()}};s.\u0275fac=function(t){return new(t||s)(a(Z),a(q),a(K))},s.\u0275cmp=b({type:s,selectors:[["app-lesson"]],viewQuery:function(t,i){if(t&1&&Y(wt,5),t&2){let r;z(r=$())&&(i.recorder=r.first)}},inputs:{lesson:"lesson",sessionId:"sessionId"},outputs:{onNextLesson:"onNextLesson"},standalone:!0,features:[y],ngContentSelectors:St,decls:4,vars:5,consts:[["audioRecorder",""],["class","lesson-submitting-loading",4,"ngIf"],[4,"ngIf"],[1,"mat-title-medium","primary-heading"],[1,"mat-title-large"],[1,"mat-body-medium"],[3,"onReady"],[1,"lesson-submitting-loading"],["mode","indeterminate"],[3,"audioUrl"],[1,"mat-body-large"],[1,"lesson-actions"],["mat-button","",3,"click"],["mat-flat-button","",1,"continue-btn",3,"click"]],template:function(t,i){t&1&&(H(),x(0,Lt,10,1)(1,kt,2,0,"div",1)(2,Pt,2,0,"ng-content",2),U(3,"async")),t&2&&(N(i.feedback.value?-1:0),m(),d("ngIf",i.isSubmitting),m(),d("ngIf",X(3,3,i.feedback)))},dependencies:[Ue,Xe,I,D,Q,P,J,Ye,Be],styles:[".lesson-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.lesson-actions[_ngcontent-%COMP%]   .continue-btn[_ngcontent-%COMP%]{flex:1}.lesson-submitting-loading[_ngcontent-%COMP%]{margin:12px 0}"]});let o=s;return o})();function Mt(o,s){if(o&1){let n=g();l(0,"app-lesson",3),f("onNextLesson",function(t){_(n);let i=p(2);return u(i.handleNextLesson(t))}),c()}if(o&2){let n=p(2);d("lesson",n.currentLesson)("sessionId",n.session.id)}}function Et(o,s){if(o&1){let n=g();Ie(0),l(1,"app-session-progress",1),f("onClickLesson",function(t){_(n);let i=p();return u(i.changeLesson(t))}),c(),x(2,Mt,1,2,"app-lesson",2),xe()}if(o&2){let n=p();m(),d("lessons",n.session.lessonsItens)("currentLessonId",n.currentLesson.id)("sessionId",n.session.id)("isRecording",!1),m(),d("ngIf",n.currentLesson)}}var it=(()=>{let s=class s{constructor(){this.onFinishSession=k(),this.currentLesson=null}ngOnInit(){this.currentLesson=this.session.lessonsItens.find(e=>!e.answered)??this.session.lessonsItens[0]}changeLesson(e){let t=this.session.lessonsItens.find(i=>i.id===e);this.currentLesson=t}finishSession(){this.onFinishSession.emit()}handleNextLesson(e){if(!e){this.finishSession();return}this.changeLesson(e)}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=b({type:s,selectors:[["app-session-content"]],inputs:{session:"session"},outputs:{onFinishSession:"onFinishSession"},standalone:!0,features:[y],decls:1,vars:1,consts:[[4,"ngIf"],[3,"onClickLesson","lessons","currentLessonId","sessionId","isRecording"],[3,"lesson","sessionId","onNextLesson",4,"ngIf"],[3,"onNextLesson","lesson","sessionId"]],template:function(t,i){t&1&&x(0,Et,3,5,"ng-container",0),t&2&&d("ngIf",i.currentLesson)},dependencies:[et,tt,I,D],styles:["app-session-progress[_ngcontent-%COMP%]{margin:8px 0}"]});let o=s;return o})();var Rt=["*"];function Ot(o,s){o&1&&(l(0,"div",2),w(1,"mat-progress-spinner",3),c())}function At(o,s){if(o&1&&w(0,"app-session-feedback",5),o&2){let n=p(3).ngIf;d("feedback",n.feedback)("rating",n.rating)}}function Ft(o,s){if(o&1&&x(0,At,1,2,"app-session-feedback",7),o&2){let n=p(2).ngIf;d("ngIf",n.feedback)}}function Vt(o,s){if(o&1){let n=g();l(0,"app-session-content",8),f("onFinishSession",function(){_(n);let t=p(3);return u(t.finishSession())}),c()}if(o&2){let n=p(2).ngIf;d("session",n)}}function jt(o,s){if(o&1){let n=g();l(0,"header")(1,"app-dashboard-page-title",4),f("onClickBack",function(){_(n);let t=p(2);return u(t.goHome())}),c()(),x(2,Ft,1,1,"app-session-feedback",5)(3,Vt,1,1,"app-session-content",6)}if(o&2){let n=p().ngIf;m(),d("title",n.title),m(),N(n.feedback?2:3)}}function Nt(o,s){o&1&&B(0,0,["*ngIf","!isLoading && (session | async) as sessionData"],jt,4,2)}var qi=(()=>{let s=class s{constructor(e,t,i,r,h){this.route=e,this.router=t,this.http=i,this.baseUrl=r,this.snackBar=h,this.sessionId=new M(null),this.session=new M(null),this.isLoading=!1,this.error="",this.subscribeSession(),this.subscribeSessionId(),this.subscribeRoute()}subscribeRoute(){this.route.paramMap.subscribe(e=>{let t=+e.get("sessionId");this.sessionId.next(t)})}subscribeSessionId(){this.sessionId.subscribe(e=>{e&&this.http.get(`${this.baseUrl}/sessions/${this.sessionId.value}`).pipe(E(()=>{this.isLoading=!1})).subscribe({next:t=>{this.session.next(t)},error:t=>{this.error=`${t.status} ${t.statusText}`,this.snackBar.open(`Error: ${t.status} ${t.statusText}`,"Dismiss",{duration:1e4})}})})}subscribeSession(){this.session.subscribe(e=>{})}finishSession(){this.isLoading=!0,this.http.post(`${this.baseUrl}/sessions/${this.sessionId.value}/finish`,{}).pipe(E(()=>{this.isLoading=!1})).subscribe({next:e=>{let t=this.session.value;if(!t)return;let i=ce(L({},t),{feedback:e.feedback,rating:e.rating});this.session.next(i)},error:e=>{this.error=`${e.status} ${e.statusText}`,this.snackBar.open(`Error: ${e.status} ${e.statusText}`,"Dismiss",{duration:1e4})}})}goHome(){this.router.navigate(["/"])}};s.\u0275fac=function(t){return new(t||s)(a(Le),a(W),a(Z),a(q),a(K))},s.\u0275cmp=b({type:s,selectors:[["app-session"]],standalone:!0,features:[y],ngContentSelectors:Rt,decls:3,vars:4,consts:[["class","loading-session",4,"ngIf"],[4,"ngIf"],[1,"loading-session"],["mode","indeterminate"],[3,"onClickBack","title"],[3,"feedback","rating"],[3,"session"],[3,"feedback","rating",4,"ngIf"],[3,"onFinishSession","session"]],template:function(t,i){t&1&&(H(),x(0,Ot,2,0,"div",0)(1,Nt,2,0,"ng-content",1),U(2,"async")),t&2&&(d("ngIf",i.isLoading),m(),d("ngIf",!i.isLoading&&X(2,2,i.session)))},dependencies:[ze,I,D,Q,He,Ne,P,Ge,it],styles:["[_nghost-%COMP%]{width:calc(100% - 24px);max-width:648px;padding:24px 0;display:flex;flex-direction:column;flex:1}.loading-session[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.full-btn[_ngcontent-%COMP%]{width:100%}"]});let o=s;return o})();export{qi as SessionComponent};
